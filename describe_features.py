from collections import Counter
import json
import requests
# 定义数字列表
numbers = [3350, 2424, 2752, 11566, 11653, 3050, 11018, 1563, 3996, 13589, 7644, 15662, 13000, 13032, 2210, 15312, 12056, 2205, 13513, 94, 421, 3858, 4884, 12653, 10243, 5263, 6608, 9423, 10860, 11592, 7637, 7618, 14613, 8065, 8509, 7341, 2645, 15954, 1988, 5490, 11985, 16300, 4017, 11076, 5425, 11049, 5429, 9227, 9795, 10178, 10566, 11073, 13907, 16094, 4946, 6129, 630, 7543, 1883, 8280, 14727, 12656, 12493, 7704, 13775, 1008, 6206, 7624, 11423, 14848, 14950, 2678, 3440, 4051, 7827, 8575, 13593, 16186, 13586, 16105, 6789, 147, 514, 1000, 7470, 15037, 577, 1447, 1007, 2632, 4071, 4807, 5964, 6954, 10744, 12099, 12827, 14148, 1365, 6023, 11288, 14292, 3069, 11399, 15613, 15095, 3583, 6004, 7606, 8723, 12947, 13450, 14119, 14616, 4822, 7362, 11322, 2390, 7841, 13853, 12417, 16335, 8967, 5592, 6633, 7468, 10481, 289, 5503, 6447, 6979, 10145, 11716, 16095, 5587, 6647, 11081, 5771, 9079, 10634, 15081, 15211, 15812, 8974, 3908, 4806, 8961, 9485, 15155, 3971, 9884, 4003, 8189, 10614, 611, 916, 1866, 2784, 3114, 3611, 6591, 10134, 10781, 11123, 13430, 212, 3382, 4300, 9317, 15087, 15214, 2213, 4146, 6187, 9290, 9680, 12591, 14227, 15216, 4727, 311, 4589, 7093, 11719, 13566, 13613, 15069, 15717, 16247, 495, 3519, 8541, 10733, 12579, 9682, 2397, 13520, 15408, 1158, 13070, 1363, 5014, 10825, 4928, 5887, 7732, 5373, 9976, 640, 1318, 10478, 11280, 6094, 7588, 13478, 1271, 1326, 3144, 3704, 4374, 4502, 5292, 6221, 7466, 7662, 7682, 9260, 10210, 10765, 11377, 11453, 11928, 12003, 13596, 14268, 15491, 647, 1364, 1648, 1826, 2185, 2301, 2317, 2352, 2611, 4099, 4135, 4281, 4325, 4435, 4625, 4861, 4867, 5278, 5761, 5769, 6083, 6108, 6727, 7481, 7535, 7591, 7652, 7816, 7957, 7983, 8308, 8418, 8469, 8681, 9109, 9291, 9373, 9404, 9644, 9679, 9730, 10315, 10482, 10684, 11400, 11438, 11631, 11944, 12076, 12101, 12435, 13935, 14035, 14147, 15398, 15505, 15791, 15840, 16151, 2130, 4422, 4535, 5233, 7115, 7916, 9872, 10463, 11807, 15739, 15820, 4877, 5824, 8050, 8273, 16332, 5042, 6888, 7129, 8483, 16101, 1583, 7047, 15985, 6265, 15028, 15614, 829, 3622, 4705, 7231, 8223, 14453, 5789, 7380, 14875, 2306, 4101, 4130, 4172, 4545, 4614, 4752, 5537, 5738, 6189, 6352, 7901, 8081, 9040, 12761, 14288, 14304, 14355, 14515, 14538, 15952, 787, 1522, 3454, 5251, 5593, 7733, 7998, 8693, 9158, 11637, 12548, 13095, 13801, 13942, 16291, 4721, 5433, 6044, 7297, 14922, 2592, 3746, 4395, 4732, 5060, 5478, 7799, 10241, 11391, 11556, 15735, 13414, 8802, 9560, 9753, 13284, 68, 747, 4432, 14926, 15187, 15376, 232, 3643, 7580, 10454, 10455, 11603, 11707, 13541, 13580, 13640, 13919, 939, 2216, 2722, 5402, 9840, 4031, 5108, 7959, 14465, 2157, 2974, 3522, 3959, 4046, 5746, 7284, 9625, 10742, 11044, 11056, 11599, 12730, 13323, 13341, 13728, 574, 1636, 2659, 6606, 7523, 14328, 813, 2861, 5061, 5083, 13951, 14505, 14601, 923, 3414, 7549, 13153, 13178, 15250, 1408, 2676, 6598, 6917, 8604, 9430, 10594, 10657, 11232, 13009, 16156, 225, 357, 1084, 1184, 1710, 5880, 6181, 8217, 8277, 8730, 9849, 11301, 11434, 11903, 12571, 13828, 15298, 15837, 16172, 6597, 10815, 591, 2829, 3322, 3461, 3672, 3743, 4389, 4616, 5590, 6268, 6533, 8982, 9310, 9633, 12085, 12128, 12402, 13402, 13815, 14309, 841, 5050, 6580, 6834, 8567, 9397, 9920, 12466, 14774, 15194, 15482, 1080, 1237, 2557, 4845, 5938, 7305, 8184, 8741, 12155, 12393, 12901, 14590, 14654, 15094, 15446, 4930, 5154, 14742, 15573, 687, 7692, 8572, 10813, 13713, 13940, 14673, 15770, 16174, 607, 676, 866, 995, 2100, 2450, 2461, 2577, 2788, 2968, 2976, 3410, 4519, 4914, 5666, 5871, 6099, 7806, 8363, 8691, 8767, 8866, 9058, 9973, 10138, 10754, 11611, 11768, 12245, 12519, 12629, 13015, 13373, 14376, 14405, 14661, 14896, 14928, 15132, 16141, 3301, 11454, 64, 1278, 2097, 3175, 4344, 6411, 9698, 10408, 11116, 11816, 16075, 1011, 2727, 3763, 5894, 11617, 5665, 6940, 11949, 13084, 13544, 14060, 14861, 512, 4718, 6518, 12234, 12336, 12846, 15578, 16104, 3211, 6768, 7344, 7585, 8686, 11667, 11695, 1722, 6328, 7227, 8777, 9939, 10096, 10942, 13754, 13980, 1718, 2793, 3059, 3472, 4490, 4965, 5935, 5940, 6778, 7685, 8850, 8950, 9413, 9498, 10203, 10949, 11241, 12104, 13632, 13766, 14939, 837, 2036, 2052, 3821, 5145, 7365, 7544, 7906, 9181, 10897, 11201, 11654, 12206, 12917, 12993, 13160, 14378, 14744, 15444, 2521, 4927, 7467, 10937, 11854, 12926, 13068, 14338, 175, 327, 390, 2221, 2697, 3145, 3352, 4563, 4581, 5915, 7409, 8468, 9202, 9718, 10058, 10216, 11286, 11704, 12194, 12492, 13264, 14554, 14581, 14712, 15048, 427, 6170, 7854, 9803, 12301, 15114, 2554, 5552, 5744, 6049, 6417, 6801, 7174, 7230, 9223, 11664, 12611, 14008, 14957, 3079, 3784, 3866, 4966, 7664, 8360, 9224, 9779, 10319, 10660, 11062, 11825, 12239, 13937, 14659, 15191, 16190, 431, 3627, 15689, 489, 2794, 3227, 4819, 10729, 13053, 13802, 1290, 3697, 5442, 6132, 6582, 9492, 296, 1981, 3385, 4873, 4921, 6333, 6370, 9133, 9860, 11433, 12096, 12706, 12768, 12900, 13245, 13564, 13890, 15030, 285, 2428, 2665, 2742, 4012, 4778, 6390, 9111, 9437, 9935, 11439, 11562, 12516, 12659, 12715, 12744, 13572, 14069, 16337, 13344, 15732, 112, 134, 277, 425, 839, 1118, 1181, 2234, 2291, 2376, 3149, 3193, 3236, 4207, 4209, 4469, 4573, 4605, 4689, 5115, 5144, 5153, 5330, 5479, 5868, 6138, 6270, 6357, 6500, 6583, 6651, 6669, 6708, 7199, 7226, 7712, 7782, 8100, 8104, 8637, 8813, 9634, 9928, 9963, 9997, 10136, 10409, 10890, 11039, 11374, 11852, 11856, 12041, 12311, 12418, 12716, 13636, 13697, 13750, 13792, 13968, 14544, 14930, 15029, 15714, 139, 533, 550, 731, 1793, 4530, 4749, 4869, 5626, 5921, 6067, 6376, 6528, 6809, 8284, 8675, 8799, 9392, 12168, 13313, 14800, 2, 2011, 3014, 3285, 12957, 15838, 74, 120, 1404, 2253, 3832, 3920, 5035, 6261, 6915, 7643, 9047, 10456, 13239, 14396, 15461, 845, 5175, 6252, 6319, 7598, 15496, 15869, 7855, 1383, 3427, 5726, 12098, 16002, 182, 215, 229, 318, 805, 886, 1775, 2110, 2326, 2668, 2997, 3085, 3620, 4354, 6073, 6914, 7321, 7327, 8814, 8847, 8916, 9526, 10018, 10086, 10432, 10785, 10861, 11103, 11106, 11996, 14897, 15292, 67, 375, 416, 1215, 1697, 3379, 3538, 4005, 4064, 5341, 5461, 6136, 6808, 7234, 10571, 12931, 14064, 15420, 15939, 2015, 2, 567, 2165, 2464, 7903, 8315, 9257, 11832, 13192, 13903, 14003, 14674, 927, 1399, 4028, 4368, 6466, 6479, 8334, 8769, 9471, 10071, 16020, 603, 1624, 1633, 3314, 3388, 3706, 4108, 4285, 4935, 5198, 5385, 5411]


def extract_description_from_html(text):
    # 查找 "title=" 的位置
    start = text.find('title=')
    if start == -1:
        return None  # 如果没有找到 "title="，返回None
    
    start += len('title=')  # 移动到 "title=" 之后
    
    # 检查第一个字符是否是引号（"或'）
    if start < len(text) and text[start] in ('"', "'"):
        quote_char = text[start]
        start += 1  # 跳过引号
        end = text.find(quote_char, start)  # 查找匹配的结束引号
    else:
        # 如果没有引号，找到下一个空格或字符串结束
        end = text.find(' ', start)
        if end == -1:
            end = len(text)
    
    if end == -1:
        return text[start:]  # 如果没有找到结束引号，返回剩余部分
    return text[start:end]

html_template = "https://neuronpedia.org/{}/{}/{}?embed=true&embedexplanation=true&embedplots=true&embedtest=true&height=300"
# "https://neuronpedia.org/gpt2-small/9-res-jb/7798?embed=true&embedexplanation=true&embedplots=true&embedtest=true&height=300"

def get_dashboard_html(sae_release = "gpt2-small", sae_id="9-res-jb", feature_idx=0):
    return html_template.format(sae_release, sae_id, feature_idx)

# 输出结果
for number in numbers:
    html = get_dashboard_html(sae_release="gpt2-small", sae_id="9-res-jb", feature_idx=number)
    html_content = requests.get(html)
    description = extract_description_from_html(html_content.text) # 5s一个feature
    print(f"{number}: {description}")
